<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hợp Đồng Lao Động HTX</title>

    <!-- Thêm các thư viện cần thiết cho xuất Word -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.37.11/docxtemplater.js"></script>
    <script src="https://unpkg.com/pizzip@3.1.4/dist/pizzip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @page {
            size: A4;
            margin: 0;
        }

        body {
            font-family: "Times New Roman", serif;
            font-size: 14px;
            line-height: 1.5;
            background: white;
            width: 210mm;
            margin: 0 auto;
            padding: 20mm;
            min-height: 297mm;
            position: relative;
        }

        .button-container {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-family: "Times New Roman", serif;
        }

        .print-button {
            background-color: #4CAF50;
            color: white;
        }

        .print-button:hover {
            background-color: #45a049;
        }

        .export-button {
            background-color: #2b579a;
            color: white;
        }

        .export-button:hover {
            background-color: #1e3f6f;
        }

        #loading-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 20px;
            border-radius: 5px;
            z-index: 2000;
        }

        .hidden {
            display: none;
        }

        /* Document header styling */
        .document-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .header-left {
            font-weight: bold;
            font-size: 14px;
            width: 45%;
        }

        .header-left .org-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .header-left .underline {
            border-bottom: 1px solid #000;
            width: 80px;
            margin: 2px 0 10px 0;
        }

        .header-right {
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            width: 50%;
        }

        .header-right .country {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .header-right .motto {
            text-decoration: underline;
            font-style: italic;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .header-right .location-date {
            font-style: italic;
            font-weight: normal;
        }

        /* Title styling */
        .document-title {
            text-align: center;
            margin: 20px 0;
        }

        .title-main {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        /* Content styling */
        .contract-parties {
            margin: 15px 0;
            text-align: justify;
            line-height: 1.6;
        }

        .contract-parties p {
            margin-bottom: 8px;
        }

        .article {
            margin: 15px 0;
            text-align: justify;
        }

        .article-title {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .article-content {
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .article-content p {
            margin-bottom: 6px;
        }

        .indent-content {
            margin-left: 20px;
            margin-bottom: 6px;
        }

        .sub-section {
            margin: 8px 0;
        }

        .sub-title {
            font-weight: bold;
            font-style: italic;
            margin-bottom: 5px;
        }

        .list-item {
            margin-left: 20px;
            margin-bottom: 4px;
        }

        /* Signature section */
        .signature-section {
            margin-top: 40px;
            display: flex;
            justify-content: space-between;
        }

        .signature-left,
        .signature-right {
            width: 45%;
            text-align: center;
        }

        .signature-title {
            font-weight: bold;
            margin-bottom: 80px;
        }

        .signature-subtitle {
            font-style: italic;
            font-size: 12px;
        }

        @media print {
            body {
                width: 210mm;
                height: 297mm;
                margin: 0;
                padding: 20mm;
            }

            .button-container {
                display: none;
            }
        }

        @media screen {
            body {
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                margin: 20px auto;
            }
        }

        .bold {
            font-weight: bold;
        }
    </style>
</head>

<body>
    <!-- Button Container -->
    <div class="button-container">
        <button class="button print-button" onclick="window.print()">
            <i class="fas fa-print"></i> In Tài Liệu
        </button>
        <button class="button export-button" onclick="exportToWordTemplate()">
            <i class="fas fa-file-word"></i> Xuất Word
        </button>
    </div>

    <!-- Loading Message -->
    <div id="loading-message">Đang tải dữ liệu...</div>

    <!-- Document Content -->
    <div class="document-header">
        <div class="header-left">
            <div class="org-name bold" id="ten-don-vi-upper"></div>
            <div class="underline"></div>
            <div>Số: <span id="so-van-ban">...</span></div>
        </div>
        <div class="header-right">
            <div class="country">CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</div>
            <div class="motto">Độc lập - Tự do - Hạnh phúc</div>
            <div class="location-date">
                <em><span id="tinh">Bắc Ninh</span>, ngày <span id="ngay">...</span> tháng <span id="thang">...</span>
                    năm <span id="nam">...</span></em>
            </div>
        </div>
    </div>

    <div class="document-title">
        <div class="title-main">HỢP ĐỒNG LAO ĐỘNG</div>
    </div>

    <div class="contract-parties">
        <p>Chúng tôi gồm một bên là Ông/Bà: <span id="nguoi-dai-dien" class="bold">...</span>. Quốc tịch: Việt Nam</p>
        <p>Chức vụ: Giám đốc</p>
        <p>Đại diện cho: <span id="ten-don-vi" class="bold">...</span></p>
        <p>Địa chỉ: <span id="dia-chi-don-vi">...</span>.</p>
        <p>Điện thoại: <span id="so-dt">...</span></p>
        <p style="margin-top: 15px;">Và một bên là Ông/Bà: <span id="ho-ten" class="bold">...</span>. Quốc tịch: Việt Nam
        </p>
        <p>Sinh ngày: <span id="ngay-sinh">...</span></p>
        <p>Nghề nghiệp: Lái xe</p>
        <p>Số Giấy phép lái xe: <span id="so-gplx">...</span></p>
        <p>Địa chỉ thường trú: <span id="dia-chi-nhan-su">...</span></p>
        <p>Số căn cước công dân: <span id="so-cccd">...</span></p>
        <p style="margin-top: 15px;">Thỏa thuận ký kết hợp đồng lao động và cam kết làm đúng như điều khoản sau đây:</p>
    </div>

    <div class="article">
        <div class="article-title">Điều 1: Thời hạn và công việc hợp đồng.</div>
        <div class="article-content">
            <div class="list-item">- Loại hợp đồng lao động: Không xác định thời hạn</div>
            <div class="list-item">- Từ ngày <span id="ngay-hieu-luc">...</span></div>
            <div class="list-item">- Địa điểm làm việc: Điều khiển xe <span id="loai-xe">...</span> biển số: <span
                    id="bien-so">...</span></div>
            <div class="list-item">- Chức danh chuyên môn: Lái xe hạng <span id="hang-gplx">...</span></div>
            <div class="list-item">- Chức vụ: <span id="chuc-vu">...</span></div>
            <div class="list-item">- Công việc phải làm: Thực hiện theo sự điều động, phân công của HTX.</div>
        </div>
    </div>

    <div class="article">
        <div class="article-title">Điều 2: Chế độ làm việc:</div>
        <div class="article-content">
            <div class="list-item">- Thời gian làm việc: Theo quy định của Nhà Nước và của đơn vị.</div>
            <div class="list-item">- Được cấp phát những dụng cụ làm việc gồm: Xe ô tô biển số: <span
                    id="bien-so-2">...</span></div>
        </div>
    </div>

    <div class="article">
        <div class="article-title">Điều 3: Nghĩa vụ và quyền lợi của người lao động:</div>

        <div class="sub-section">
            <div class="sub-title">1. Quyền lợi:</div>
            <div class="list-item">- Phương tiện đi lại làm việc: Tự túc</div>
            <div class="list-item">- Mức lương chính hoặc tiền công: 18% doanh thu của xe biển số thực hiện được hàng
                tháng.</div>
            <div class="list-item">- Hình thức trả lương: Theo doanh thu.</div>
            <div class="list-item">- Phụ cấp gồm: Theo doanh thu.</div>
            <div class="list-item">- Được trả lương vào các ngày: Ngày 30 hàng tháng.</div>
            <div class="list-item">- Tiền thưởng: Theo doanh thu.</div>
            <div class="list-item">- Được trang bị bảo hộ lao động gồm: Đồng phục màu xanh.</div>
            <div class="list-item">- Chế độ nghỉ ngơi (nghỉ hàng tuần, phép năm, lễ, tết,...): Theo quy định của nhà
                nước và đơn vị.</div>
            <div class="list-item">- Bảo hiểm xã hội và bảo hiểm Y tế: Lái xe xin đóng theo tự nguyện tại địa phương nơi
                trú.</div>
            <div class="list-item">- Chế độ đào tạo: Khi có nhu cầu đi học nâng cao nghề nghiệp Đơn vị bố trí lái xe
                khác thay thế để được đi học.</div>
        </div>

        <div class="sub-section">
            <div class="sub-title">2. Nghĩa vụ:</div>
            <div class="list-item">- Hoàn thành những công việc đã cam kết trong hợp đồng lao động.</div>
            <div class="list-item">- Chấp hành lệnh điều hành sản xuất - kinh doanh, nội quy kỷ luật lao động, an toàn
                lao động,...</div>
            <div class="list-item">- Bồi thường vi phạm và vật chất: Nếu để mất hoặc làm hư hỏng các trang thiết bị trên
                xe phải bồi thường bằng 100% giá trị để vi phạm để vi phạm giao thông đường bộ tự bỏ tiền nộp phạt, để
                xảy ra tai nạn giao thông phải chịu trách nhiệm hoàn toàn trước pháp luật.</div>
        </div>
    </div>

    <div class="article">
        <div class="article-title">Điều 4: Nghĩa vụ và quyền hạn của người sử dụng lao động</div>

        <div class="sub-section">
            <div class="sub-title">1. Nghĩa vụ:</div>
            <div class="list-item">- Bảo đảm việc làm và thực hiện đầy đủ những điều đã cam kết trong hợp đồng lao động.
            </div>
            <div class="list-item">- Thanh toán đầy đủ, đúng thời hạn các chế độ và quyền lợi cho người lao động theo
                hợp đồng lao động, thỏa ước lao động tập thể.</div>
        </div>

        <div class="sub-section">
            <div class="sub-title">2. Quyền hạn:</div>
            <div class="list-item">- Điều hành người lao động hoàn thành công việc theo hợp đồng (bố trí, điều chuyển,
                tạm ngừng việc).</div>
            <div class="list-item">- Tạm hoãn, chấm dứt hợp đồng lao động, kỷ luật người lao động theo quy định của pháp
                luật, thỏa ước lao động tập thể (nếu có) và nội quy lao động của HTX.</div>
        </div>
    </div>

    <div class="article">
        <div class="article-title">Điều 5: Điều khoản thi hành:</div>
        <div class="article-content">
            <div class="list-item">- Những vấn đề về lao động không ghi trong hợp đồng lao động này thì áp dụng quy định
                của thỏa ước lao động tập thể, trường hợp chưa có thỏa ước lao động tập thể thì áp dụng quy định của
                pháp luật lao động.</div>
            <div class="list-item">- Hợp đồng lao động được thành lập 02 bản có giá trị như nhau, mỗi bên giữ 01 bản và
                có hiệu lực kể từ ngày <span id="ngay-hieu-luc-2">...</span>. Khi hai bên ký kết phụ lục hợp đồng lao
                động thì nội dung của phụ lục hợp đồng cũng có giá trị như các nội dung của bản hợp đồng lao động này.
            </div>
            <p style="margin-top: 10px;">Hợp đồng này làm tại <span id="ten-don-vi-footer" class="bold"></span>.</p>
        </div>
    </div>

    <div class="signature-section">
        <div class="signature-left">
            <div class="signature-title">NGƯỜI LAO ĐỘNG</div>
            <div class="signature-subtitle">(Ký, ghi rõ họ tên)</div>
        </div>
        <div class="signature-right">
            <div class="signature-title">NGƯỜI SỬ DỤNG LAO ĐỘNG</div>
            <div class="signature-subtitle">(Ký, ghi rõ họ tên)</div>
        </div>
    </div>

    <script>
        // Constants for AppSheet connection
        const appId = '50b5e0e5-79c2-42b8-a3bd-095741190d4c';
        const accessKey = 'V2-Bwq7a-rGM2F-aX9Zj-8h4gC-0JdWA-IzAqM-mtJr7-jcuBw';
        const region = 'www';

        // Biến toàn cục để lưu dữ liệu
        let globalContractData = null;

        // Function to get IDHoSo from URL
        function getIDHoSoFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('IDHoSo') || urlParams.get('idhoso');
        }

        // Function to fetch data from AppSheet
        async function fetchAppSheetData(tableName, filter = null) {
            try {
                const selector = filter || `Filter(${tableName}, true)`;
                console.log(`🔍 Executing selector for ${tableName}:`, selector);

                const body = {
                    Action: 'Find',
                    Properties: {},
                    Selector: selector
                };

                const response = await fetch(`https://${region}.appsheet.com/api/v2/apps/${appId}/tables/${tableName}/Action`, {
                    method: 'POST',
                    headers: {
                        'ApplicationAccessKey': accessKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log(`🔍 Response for ${tableName}:`, data);
                return Array.isArray(data) ? data : [];
            } catch (error) {
                console.error(`Failed to fetch ${tableName}:`, error);
                throw error;
            }
        }

        // Format date từ Date thành dd/mm/yyyy
        function formatDateShort(dateString) {
            if (!dateString || dateString === '') {
                return '';
            }

            let date;
            if (typeof dateString === 'string') {
                if (dateString.includes('/')) {
                    const parts = dateString.split('/');
                    if (parts.length === 3) {
                        const day = parseInt(parts[0]);
                        const month = parseInt(parts[1]);
                        const year = parseInt(parts[2]);
                        date = new Date(year, month - 1, day);
                    }
                } else if (dateString.includes('-')) {
                    date = new Date(dateString);
                } else {
                    date = new Date(dateString);
                }
            } else if (dateString instanceof Date) {
                date = dateString;
            } else {
                return dateString.toString();
            }

            if (isNaN(date.getTime())) {
                return dateString.toString();
            }

            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();

            return `${day}/${month}/${year}`;
        }

        // Format date đầy đủ cho ngày hiệu lực
        function formatDateFull(dateString) {
            console.log('🔍 formatDateFull input:', dateString, typeof dateString);

            if (!dateString || dateString === '') {
                return '';
            }

            let date;

            // AppSheet trả về MM/DD/YYYY format
            if (typeof dateString === 'string' && dateString.includes('/')) {
                const parts = dateString.split('/');
                if (parts.length === 3) {
                    const month = parseInt(parts[0]);  // Tháng đầu tiên
                    const day = parseInt(parts[1]);    // Ngày thứ hai  
                    const year = parseInt(parts[2]);   // Năm cuối

                    date = new Date(year, month - 1, day);
                    console.log('🔍 Parsed from MM/DD/YYYY:', `${month}/${day}/${year} → ${date}`);
                }
            } else {
                date = new Date(dateString);
            }

            if (!date || isNaN(date.getTime())) {
                console.log('❌ Invalid date:', dateString);
                return dateString.toString();
            }

            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();

            const result = `${day.toString().padStart(2, '0')} tháng ${month} năm ${year}`;
            console.log('✅ Final formatted:', result);

            return result;
        }

        // Get current date components
        function getCurrentDateComponents(ngayKy) {
            // Nếu truyền vào ngày (ngayKy) thì ưu tiên dùng ngày đó
            if (ngayKy) {
                try {
                    let date = null;

                    if (typeof ngayKy === 'string' && ngayKy.includes('/')) {
                        // AppSheet trả về MM/DD/YYYY
                        const parts = ngayKy.split('/');
                        if (parts.length === 3) {
                            const month = parseInt(parts[0], 10);
                            const day = parseInt(parts[1], 10);
                            const year = parseInt(parts[2], 10);
                            date = new Date(year, month - 1, day);
                        }
                    } else {
                        date = new Date(ngayKy);
                    }

                    if (date && !isNaN(date.getTime())) {
                        return {
                            day: date.getDate().toString().padStart(2, '0'),
                            month: date.getMonth() + 1,
                            year: date.getFullYear()
                        };
                    }
                } catch (e) {
                    console.warn('Không parse được NgayKy, sẽ dùng ngày hiện tại', e);
                }
            }

            // Fallback: ngày hiện tại
            const today = new Date();
            return {
                day: today.getDate().toString().padStart(2, '0'),
                month: today.getMonth() + 1,
                year: today.getFullYear()
            };
        }

        // Extract province from address
        function extractProvince(address) {
            if (!address) return 'Bắc Ninh';
            const provincePrefixes = ['Tỉnh ', 'Thành phố ', 'TP. ', 'T.P '];
            const parts = address.split(',');
            let lastPart = parts[parts.length - 1].trim();

            for (const prefix of provincePrefixes) {
                if (lastPart.startsWith(prefix)) {
                    lastPart = lastPart.substring(prefix.length).trim();
                    break;
                }
            }

            return lastPart || 'Bắc Ninh';
        }

        // Load data from AppSheet
        async function loadData() {
            try {
                const idHoSo = getIDHoSoFromURL();
                console.log('🔍 ID từ URL:', idHoSo);

                if (!idHoSo) {
                    throw new Error('Không tìm thấy IDHoSo trong URL');
                }

                // Fetch dữ liệu từ các bảng
                const [hosoList, donviList, xeList, nhansuList] = await Promise.all([
                    fetchAppSheetData('HOSONHANSU', `Filter(HOSONHANSU, [IDHoSo] = "${idHoSo}")`),
                    fetchAppSheetData('THONGTINDONVI'),
                    fetchAppSheetData('THONGTINXE'),
                    fetchAppSheetData('THONGTINNHANSU')
                ]);

                if (!hosoList || hosoList.length === 0) {
                    throw new Error('Không tìm thấy hồ sơ với ID này');
                }

                const hosoData = hosoList.find(item => item.IDHoSo === idHoSo);
                if (!hosoData) {
                    throw new Error(`Không tìm thấy ID "${idHoSo}"`);
                }

                const donviData = donviList.length > 0 ? donviList[0] : {};
                const xeData = hosoData.Ref_Xe ?
                    xeList.find(x => x.Idxe === hosoData.Ref_Xe) || {} : {};
                const nhansuData = hosoData.Ref_ThanhVien ?
                    nhansuList.find(n => n.IDNS === hosoData.Ref_ThanhVien) || {} : {};

                const currentDate = getCurrentDateComponents(hosoData.NgayKy);

                // Lưu dữ liệu cho xuất Word
                globalContractData = {
                    IDHoSo: hosoData.IDHoSo || '',
                    SoVanBan: hosoData.SoVanBan || '',
                    Tendonvi: donviData.Tendonvi || '',
                    Tendonvi_Uper: (donviData.Tendonvi || '').toUpperCase(),
                    Nguoidaidien: donviData.Nguoidaidien || '',
                    Hoten: nhansuData.Hoten || '',
                    Ngaysinh: formatDateShort(nhansuData.Ngaysinh),
                    SoCCCD: nhansuData.NoCCCD || '',
                    SoGPLX: nhansuData.SoGPLX || '',
                    Diachi: donviData.Diachi || '',
                    Diachidaydu: nhansuData.Diachidaydu || '',
                    Loaixe: xeData.Loaixe || '',
                    Bienso: xeData.Bienso || '',
                    SoDT: donviData.SoDT || '',
                    HangGPLX: nhansuData['Hạng GPLX'] || '',
                    Chucvu: nhansuData.Chucvu || '',
                    NgayHieuLuc_dai: formatDateFull(hosoData.NgayHieuLuc || ''),
                    Tinh: extractProvince(nhansuData.Diachidaydu),
                    Ngay: currentDate.day,
                    Thang: currentDate.month === 1 || currentDate.month === 2 ?
                        currentDate.month.toString().padStart(2, '0') : currentDate.month.toString(),
                    Nam: currentDate.year
                };

                // Populate HTML với dữ liệu
                populateHTML(globalContractData);
                hideLoadingMessage();

            } catch (error) {
                console.error('Error loading data:', error);
                hideLoadingMessage();
                alert('Lỗi: ' + error.message);
            }
        }

        // Populate HTML with data
        function populateHTML(data) {
            const setText = (id, value) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value || '';
                }
            };

            setText('ten-don-vi-upper', data.Tendonvi_Uper);
            setText('so-van-ban', data.SoVanBan);
            setText('tinh', data.Tinh);
            setText('ngay', data.Ngay);
            setText('thang', data.Thang);
            setText('nam', data.Nam);
            setText('nguoi-dai-dien', data.Nguoidaidien);
            setText('ten-don-vi', data.Tendonvi);
            setText('dia-chi-don-vi', data.Diachi);
            setText('so-dt', data.SoDT);
            setText('ho-ten', data.Hoten);
            setText('ngay-sinh', data.Ngaysinh);
            setText('so-gplx', data.SoGPLX);
            setText('dia-chi-nhan-su', data.Diachidaydu);
            setText('so-cccd', data.SoCCCD);
            setText('ngay-hieu-luc', data.NgayHieuLuc_dai);
            setText('bien-so', data.Bienso);
            setText('loai-xe', data.Loaixe);
            setText('bien-so-2', data.Bienso);
            setText('hang-gplx', data.HangGPLX);
            setText('chuc-vu', data.Chucvu);
            setText('ngay-hieu-luc-2', data.NgayHieuLuc_dai);
            setText('ten-don-vi-footer', data.Tendonvi);
        }

        // Export to Word template
        async function exportToWordTemplate() {
            try {
                if (!globalContractData) {
                    alert('Dữ liệu chưa được tải. Vui lòng đợi dữ liệu tải xong.');
                    return;
                }

                document.getElementById('loading-message').style.display = 'block';
                document.getElementById('loading-message').textContent = 'Đang xuất file Word...';

                // URL template cho hợp đồng lao động
                const templateUrl = 'https://poalninh.github.io/templates/templates/hdld_template.docx';

                const response = await fetch(templateUrl);
                if (!response.ok) {
                    throw new Error('Không thể tải template Word');
                }

                const templateContent = await response.arrayBuffer();
                const zip = new PizZip(templateContent);
                const doc = new window.docxtemplater(zip, {
                    paragraphLoop: true,
                    linebreaks: true
                });

                doc.setData(globalContractData);
                doc.render();
                const blob = doc.getZip().generate({
                    type: "blob",
                    mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
                });

                const fileName = `HopDongLaoDong_HTX_${globalContractData.Hoten || 'Document'}.docx`;
                saveAs(blob, fileName);

                hideLoadingMessage();

            } catch (error) {
                console.error('Lỗi xuất file Word:', error);
                alert('Có lỗi xảy ra khi xuất file Word: ' + error.message);
                hideLoadingMessage();
            }
        }

        // Hide loading message
        function hideLoadingMessage() {
            document.getElementById('loading-message').classList.add('hidden');
        }

        // Initialize application
        async function initialize() {
            try {
                const idHoSo = getIDHoSoFromURL();
                if (!idHoSo) {
                    alert('Vui lòng cung cấp IDHoSo trong URL. Ví dụ: ?IDHoSo=HS001');
                    return;
                }
                await loadData();
            } catch (error) {
                console.error('Initialization error:', error);
                alert('Không thể kết nối với hệ thống. Vui lòng thử lại sau.');
            }
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(() => {
                initialize();
            }, 500);
        });

        // Disable right-click and F12
        document.addEventListener('contextmenu', function (e) {
            e.preventDefault();
        }, false);

        document.onkeydown = function (e) {
            if (e.keyCode == 123) {
                return false;
            }
            if (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) {
                return false;
            }
            if (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) {
                return false;
            }
            if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) {
                return false;
            }
        };
    </script>
</body>

</html>